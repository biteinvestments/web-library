{"version":3,"file":"bite-ui-upload.js","sources":["../../projects/bite-ui/upload/upload.component.ts","../../projects/bite-ui/upload/upload.module.ts","../../projects/bite-ui/upload/public-api.ts","../../projects/bite-ui/upload/bite-ui-upload.ts"],"sourcesContent":["import { Component, OnInit, Input, Output, EventEmitter, ElementRef, ViewChild, SimpleChanges } from '@angular/core';\nimport { Observable } from 'rxjs';\n\n  // readonly apiPrefix = CommonSetting.API + '/v1.0/file';\n  // /**\n  //  * @description 上传文件\n  //  * @param file \n  //  * @param container \n  //  */\n  //  uploadFile(file: File, container?: FileContainer): Observable<any> {\n  //   const url = this.apiPrefix + '/upload';\n  //   const formData = new FormData();\n  //   formData.append('file', file);\n  //   if (container) {\n  //     formData.append('container', container);\n  //   }\n    \n  //   return this.http.post(url, formData).pipe(\n  //     map((res: Res) => {\n  //       if (res.success) {\n  //         return res.data;\n  //       }\n  //       throw { msg: res?.msg || 'some error', errorKey: res?.errorKey };\n  //     }),\n  //     catchError(this.logSv.handleError<Res>('Post upload File'))\n  //   )\n  // }\n@Component({\n  selector: 'bite-upload',\n  templateUrl: './upload.component.html',\n  styleUrls: ['./upload.component.scss']\n})\nexport class UploadComponent implements OnInit {\n\n  /**\n   * @description 上传文件\n   * @param file \n   * @param container \n   */\n  @Input() uploadFileFn: any\n\n  \n\n  @Input() accept?: string;\n  @Input() acceptTip?: string;\n  @Input() title?: string;\n  @Input() disabled?: boolean;\n  @Input() value?: any;\n  @Input() defaultValue?:any; // 异步回显值\n  @Input() loading?: boolean;\n  @Input() touch?: boolean;\n  @Output() resultEvent = new EventEmitter<any>();\n  @Output() resetTouch = new EventEmitter<any>();\n\n  @ViewChild('INPUT_REF') inputRef: ElementRef;\n  fileList = [];\n  uploadResult: any;\n  success = false;\n  error = false;\n  uploading = false;\n  showModalSuccess = false;\n  showModalLoading = false;\n\n  get classname(): string {\n    let name = [];\n    if (this.disabled || this.loading) {\n      name.push('upload-disabled')\n    }\n    if (this.touch) {\n      name.push('upload-error')\n    }\n    return name.join(' ');\n  }\n\n  constructor(\n  ) { }\n\n  ngOnInit(): void {\n    if (this.disabled && this.value) {\n      this.fileList.push({ file: this.value, status: 'finished'});\n    }\n  }\n  ngOnChanges(changes: SimpleChanges) {\n    // 回显默认值\n    if (changes.defaultValue && changes.defaultValue.currentValue) {\n      this.fileList = []\n      this.fileList.push({ file: changes.defaultValue.currentValue, status: 'finished'})\n    }\n\n\n  }\n\n  ngAfterViewInit(): void {\n    this.fileDomInitUpload();\n  }\n\n  fileDomInitUpload() {\n    const { inputRef } = this;\n    const _ = this;\n    this.inputRef.nativeElement.onchange = (e) => {\n      const files = inputRef.nativeElement.files;\n      for (let i = 0, ii = files.length; i < ii; i++) {\n        _.uploadFile(files[i]);\n      }\n    };\n  }\n\n  uploadFile(file: File): void {\n    this.uploading = true;\n    this.showModalLoading = true;\n    this.fileList.push({\n      file,\n      status: 'uncommit'\n    });\n    this.uploadFileFn(file).subscribe(data => {\n      this.uploadResult = data;\n      this.success = true;\n      this.fileList[0].status = 'finished';\n      this.fileList[0].downloadUrl = data.downloadUrl;\n      this.fileList[0].previewUrl = data.previewUrl;\n      console.log('this.fileList', this.fileList);\n      this.resultEvent.emit(this.uploadResult);\n      this.showModalLoading = false;\n      this.showModalSuccess = true;\n      setTimeout(() => {\n        this.showModalSuccess = false;\n        this.uploading = false;\n      }, 1000);\n    }, err => {\n      console.log(err);\n      this.uploadResult = err;\n      this.showModalLoading = false;\n      this.error = true;\n    })\n  }\n\n  chooseFile(): void {\n    if (this.disabled) {\n      return;\n    }\n    if (this.fileList.length === 0) {\n      this.inputRef.nativeElement.click();\n      this.resetTouch.emit();\n    }\n  }\n\n  handleDelete(): void {\n    this.inputRef.nativeElement.value = '';\n    this.fileList = [];\n    this.success = false;\n    this.error = false;\n  }\n\n  reUpload(): void {\n    this.handleDelete();\n    this.chooseFile();\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { UploadComponent } from './upload.component';\n\n\n\n@NgModule({\n  declarations: [UploadComponent],\n  exports: [UploadComponent],\n  imports: [\n    CommonModule\n  ]\n})\nexport class UploadModule { }\n","/*\n* Public API Surface of Button\n*/\nexport * from './upload.component';\nexport * from './upload.module';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}