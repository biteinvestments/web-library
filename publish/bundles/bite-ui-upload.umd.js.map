{"version":3,"file":"bite-ui-upload.umd.js","sources":["../../projects/bite-ui/upload/upload.component.ts","../../projects/bite-ui/upload/upload.module.ts","../../projects/bite-ui/upload/public-api.ts","../../projects/bite-ui/upload/bite-ui-upload.ts"],"sourcesContent":["import { Component, OnInit, Input, Output, EventEmitter, ElementRef, ViewChild, SimpleChanges } from '@angular/core';\nimport { Observable } from 'rxjs';\n\n  // readonly apiPrefix = CommonSetting.API + '/v1.0/file';\n  // /**\n  //  * @description 上传文件\n  //  * @param file \n  //  * @param container \n  //  */\n  //  uploadFile(file: File, container?: FileContainer): Observable<any> {\n  //   const url = this.apiPrefix + '/upload';\n  //   const formData = new FormData();\n  //   formData.append('file', file);\n  //   if (container) {\n  //     formData.append('container', container);\n  //   }\n    \n  //   return this.http.post(url, formData).pipe(\n  //     map((res: Res) => {\n  //       if (res.success) {\n  //         return res.data;\n  //       }\n  //       throw { msg: res?.msg || 'some error', errorKey: res?.errorKey };\n  //     }),\n  //     catchError(this.logSv.handleError<Res>('Post upload File'))\n  //   )\n  // }\n@Component({\n  selector: 'bite-upload',\n  templateUrl: './upload.component.html',\n  styleUrls: ['./upload.component.scss']\n})\nexport class UploadComponent implements OnInit {\n\n  /**\n   * @description 上传文件\n   * @param file \n   * @param container \n   */\n  @Input() uploadFileFn\n\n  \n\n  @Input() accept?: string;\n  @Input() acceptTip?: string;\n  @Input() title?: string;\n  @Input() disabled?: boolean;\n  @Input() value?: any;\n  @Input() defaultValue?:any; // 异步回显值\n  @Input() loading?: boolean;\n  @Input() touch?: boolean;\n  @Output() resultEvent = new EventEmitter<any>();\n  @Output() resetTouch = new EventEmitter<any>();\n\n  @ViewChild('INPUT_REF') inputRef: ElementRef;\n  fileList = [];\n  uploadResult: any;\n  success = false;\n  error = false;\n  uploading = false;\n  showModalSuccess = false;\n  showModalLoading = false;\n\n  get classname(): string {\n    let name = [];\n    if (this.disabled || this.loading) {\n      name.push('upload-disabled')\n    }\n    if (this.touch) {\n      name.push('upload-error')\n    }\n    return name.join(' ');\n  }\n\n  constructor(\n  ) { }\n\n  ngOnInit(): void {\n    if (this.disabled && this.value) {\n      this.fileList.push({ file: this.value, status: 'finished'});\n    }\n  }\n  ngOnChanges(changes: SimpleChanges) {\n    // 回显默认值\n    if (changes.defaultValue && changes.defaultValue.currentValue) {\n      this.fileList = []\n      this.fileList.push({ file: changes.defaultValue.currentValue, status: 'finished'})\n    }\n\n\n  }\n\n  ngAfterViewInit(): void {\n    this.fileDomInitUpload();\n  }\n\n  fileDomInitUpload() {\n    const { inputRef } = this;\n    const _ = this;\n    this.inputRef.nativeElement.onchange = (e) => {\n      const files = inputRef.nativeElement.files;\n      for (let i = 0, ii = files.length; i < ii; i++) {\n        _.uploadFile(files[i]);\n      }\n    };\n  }\n\n  uploadFile(file: File): void {\n    this.uploading = true;\n    this.showModalLoading = true;\n    this.fileList.push({\n      file,\n      status: 'uncommit'\n    });\n    this.uploadFileFn(file).subscribe(data => {\n      this.uploadResult = data;\n      this.success = true;\n      this.fileList[0].status = 'finished';\n      this.fileList[0].downloadUrl = data.downloadUrl;\n      this.fileList[0].previewUrl = data.previewUrl;\n      console.log('this.fileList', this.fileList);\n      this.resultEvent.emit(this.uploadResult);\n      this.showModalLoading = false;\n      this.showModalSuccess = true;\n      setTimeout(() => {\n        this.showModalSuccess = false;\n        this.uploading = false;\n      }, 1000);\n    }, err => {\n      console.log(err);\n      this.uploadResult = err;\n      this.showModalLoading = false;\n      this.error = true;\n    })\n  }\n\n  chooseFile(): void {\n    if (this.disabled) {\n      return;\n    }\n    if (this.fileList.length === 0) {\n      this.inputRef.nativeElement.click();\n      this.resetTouch.emit();\n    }\n  }\n\n  handleDelete(): void {\n    this.inputRef.nativeElement.value = '';\n    this.fileList = [];\n    this.success = false;\n    this.error = false;\n  }\n\n  reUpload(): void {\n    this.handleDelete();\n    this.chooseFile();\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { UploadComponent } from './upload.component';\n\n\n\n@NgModule({\n  declarations: [UploadComponent],\n  exports: [UploadComponent],\n  imports: [\n    CommonModule\n  ]\n})\nexport class UploadModule { }\n","/*\n* Public API Surface of Button\n*/\nexport * from './upload.component';\nexport * from './upload.module';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["EventEmitter","Component","Input","Output","ViewChild","NgModule","CommonModule"],"mappings":"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"}